<!DOCTYPE html>
<html>
<head>
  <title>Smart IoT Vending</title>
  <script src="https://sdk.cashfree.com/js/v3/cashfree.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f2f5;
      text-align: center;
      padding: 20px;
    }
    .card {
      background: white;
      padding: 18px;
      margin: 12px auto;
      max-width: 360px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    button {
      padding: 10px 16px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 15px;
    }
    button.added {
      background: #28a745 !important;
    }
  </style>
</head>

<body>

<h2>Smart IoT Vending</h2>

<div class="card">
  <h3>ü•§ Water ‚Äî ‚Çπ10</h3>
  <button id="btn_water" onclick="toggleItem('WATER',10,'btn_water')">Add Water</button>
</div>

<div class="card">
  <h3>üç™ Biscuit ‚Äî ‚Çπ10</h3>
  <button id="btn_biscuit" onclick="toggleItem('BISCUIT',10,'btn_biscuit')">Add Biscuit</button>
</div>

<div class="card">
  <h3>üßÉ Juice ‚Äî ‚Çπ10</h3>
  <button id="btn_juice" onclick="toggleItem('JUICE',10,'btn_juice')">Add Juice</button>
</div>

<div class="card">
  <h3>Order Summary</h3>
  <p id="summary">No items selected</p>
  <p><b>Total: ‚Çπ<span id="total">0</span></b></p>
  <button onclick="payNow()">Proceed to Pay</button>
  <p id="status"></p>
</div>

<script>
let selectedItems = [];
let total = 0;

function toggleItem(name, price, btnId) {
  const btn = document.getElementById(btnId);

  if (selectedItems.includes(name)) {
    selectedItems = selectedItems.filter(item => item !== name);
    total -= price;
    btn.classList.remove("added");
    btn.innerText = "Add " + name;
  } else {
    selectedItems.push(name);
    total += price;
    btn.classList.add("added");
    btn.innerText = "Added";
  }
  updateSummary();
}

function updateSummary() {
  if (selectedItems.length === 0) {
    document.getElementById("summary").innerText = "No items selected";
  } else {
    document.getElementById("summary").innerHTML =
      selectedItems.map(i => "‚Ä¢ " + i).join("<br>");
  }
  document.getElementById("total").innerText = total;
}

async function payNow() {
  if (selectedItems.length === 0) {
    alert("Please select at least one item!");
    return;
  }

  document.getElementById("status").innerText = "Creating order...";

  const res = await fetch("/api/create-order", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      amount: total,
      items: selectedItems
    })
  });

  const data = await res.json();
  if (!data.success) {
    alert("Order failed: " + data.error);
    return;
  }

  const cf = new Cashfree({ mode: "production" });
  cf.checkout({
    paymentSessionId: data.payment_session_id,
    redirectTarget: "_self"
  });
}
</script>

</body>
</html>

